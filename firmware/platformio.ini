[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600


board_build.filesystem = littlefs
board_build.partitions = partitions_3m_fs.csv

lib_deps = 
  h2zero/NimBLE-Arduino @ ^1.4.1
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
build_flags =
  ; -DARDUINO_LITTLEFS_FLASH_SIZE=0x100000
  -DCORE_DEBUG_LEVEL=3
  -Isecrets
  -Ilib
  -Iinclude
build_src_filter = +<*> +<../lib/ble/*.cpp> +<../lib/compute/*.cpp> +<../lib/ringbuf/*.cpp> +<../lib/storage/*.cpp> +<../lib/wifi/*.cpp> +<../lib/sensors/*.cpp>
monitor_filters =
  esp32_exception_decoder
  time

test_framework = unity

test_build_src = true

[platformio]
include_dir = include
src_dir = src
lib_dir = lib
default_envs = esp32dev

[env:i2cscan]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Build ONLY the scanner source; ignore everything else
build_src_filter = -<*>, +<i2c_scan.cpp>

; No extra libraries needed for the scanner
lib_deps =

; Minimal includes
build_flags =
  -Iinclude

[env:bmi270_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; pull SparkFun library straight from GitHub
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git

; build only this demo file
build_src_filter = -<*>, +<bmi270_demo.cpp>

[env:bus_recovery]
platform = espressif32
board = esp32dev
framework = arduino
upload_speed = 921600
monitor_speed = 115200
build_src_filter = -<*>, +<bus_recovery.cpp>

; --- MAX30102 demo only ---

[env:max30102_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<max30102_demo.cpp>
lib_deps =
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2

[env:aht20_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<aht20_demo.cpp>
lib_deps =
  adafruit/Adafruit AHTX0 @ ^2.0.0
  adafruit/Adafruit BusIO @ ^1.16.0

; --- MAX30102 simple demo ---
[env:max30102_simple]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<max30102_demo_simple.cpp>
lib_deps =
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2

; --- MAX30102 SpO2 + HR buffered demo ---
[env:max30102_spo2]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<max30102_spo2.cpp>
lib_deps =
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2

; --- MAX30205 demo only ---
[env:max30205_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<src/max30205_demo.cpp>
lib_deps =
  git+https://github.com/RobTillaart/MAX30205.git

; --- Subsystem 1 pack demo (read all sensors, build 256B frame) ---
[env:sub1_pack_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<src/sub1_pack_demo.cpp> +<../lib/**.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2
  robtillaart/MAX30205 @ ^0.1.4
build_flags =
  -Iinclude
  -Ilib


[env:bmi_max_dual_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<bmi_max_dual_demo.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2

[env:health_pack_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 115200
upload_port = COM68
monitor_port = COM68
; Avoid auto DTR/RTS toggling (manual boot with FT232)
upload_flags =
  --before
  no_reset
  --after
  no_reset
  --connect-attempts
  5
; Keep monitor from resetting the board
monitor_dtr = 0
monitor_rts = 0
build_src_filter = -<*>, +<health_pack_demo.cpp> +<../lib/ringbuf/*.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2
  adafruit/Adafruit AHTX0 @ ^2.0.0
  adafruit/Adafruit BusIO @ ^1.16.0
  robtillaart/MAX30205 @ ^0.1.4
build_flags =
  -Iinclude
  -Ilib

[env:current_monitor_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<current_monitor_demo.cpp>
lib_deps =
  adafruit/Adafruit INA219 @ ^1.2.3
build_flags =
  -Iinclude
  -DBATTERY_MAH=300.0

[env:demo_copy]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<demo_copy.cpp> +<../lib/ringbuf/*.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2
  adafruit/Adafruit AHTX0 @ ^2.0.0
  adafruit/Adafruit BusIO @ ^1.16.0
build_flags =
  -Iinclude
  -Ilib

[env:demo_interrupts]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_src_filter = -<*>, +<demo_interrupts.cpp> +<../lib/ringbuf/*.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
  sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2
  adafruit/Adafruit AHTX0 @ ^2.0.0
  adafruit/Adafruit BusIO @ ^1.16.0
build_flags =
  -Iinclude
  -Ilib

[env:sensors_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
; Build just the sensors demo file
build_src_filter = -<*>, +<sensors_demo.cpp>
; Use SparkFun BMI270 library for robust IMU init
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
build_flags =
  -Iinclude
  -Ilib

[env:timed_sampling_demo]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
; Build only the timer sampling verification file (Phase 1: no sensor libs required)
build_src_filter = -<*>, +<timed_sampling_demo.cpp>
lib_deps =
  https://github.com/sparkfun/SparkFun_BMI270_Arduino_Library.git#v1.0.3
build_flags =
  -Iinclude
  -Ilib
